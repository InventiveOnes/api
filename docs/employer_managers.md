# Менеджеры работодателя

* [Справочник типов и прав менеджера](#dict)
* [Добавление менеджера](#add)
* [Редактирование менеджера](#edit)
* [Удаление менеджера](#delete)
* [Справочник менеджеров работодателя](#list)
* [Получение информации о менеджере](#item)

Для получения информации необходимо авторизоваться под работодателем.
Для пользователя без авторизации или для неправильно авторизованного пользователя вернется ответ `403 Forbidden`.

<a name="dict"></a>
## Справочник типов и прав менеджера

### Запрос
`GET /employers/{employer_id}/manager_types`
 
 где `employer_id` - идентификатор работодателя, который можно узнать в
 [информации о текущем пользователе](me.md#employer-info).
 
### Ответ

Пример ответа:
```json
{
    "items": [
        {
            "id": "manager",
            "name": "Менеджер",
            "allowed_permissions": [
                {
                    "id": 1,
                    "name": "can_create_vacancy"
                },
                {
                    "id": 2,
                    "name": "can_view_resume_contacts"
                }
            ]
        }
    ]
}
```

Каждый элемент из `items` обладает следующими полями:

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | идентификатор типа менеджера
 name | строка | название типа менеджера
 allowed_permissions | список | список доступных прав
 
Поля объекта списка allowed_permissions:

 Имя | Тип | Описание
 --- | --- | ---
 id | число | идентификатор права
 name | строка | название права
 
### Ошибки
* `404 Not found` - Работодатель не найден, или у пользователя нет прав

<a name="add"></a>
## Добавление менеджера

### Запрос
`POST /employers/{employer_id}/managers`

где `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).

В теле запроса передается json вида:

```json
{
    "last_name": "Федотов",
    "first_name": "Илья",
    "middle_name": "Игоревич",
    "manager_type": "manager",
    "position": "Менеджер",
    "email": "test@test.test",
    "area": {
        "id": "1"
    },
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
         "country": "7",
         "city": "916",
         "number": "4555555",
         "comment": "личный"
    },
    "permissions": [
        {
            "id": 1,
            "name": "can_create_vacancy"
        }, 
        {
            "id": 3, 
            "name": "can_view_statistics"
        }
    ]
}
```

 Имя | Тип | Описание
 --- | --- | ---
 last_name | строка | фамилия
 first_name | строка | имя
 middle_name | строка | отчество
 manager_type | строка | [тип менеджера](#dict)
 position | строка | должность менеджера
 email | строка | электронная почта менеджера
 area.id | число | регион [из справочника](areas.md)
 phone | объект | телефон менеджера
 additional_phone | объект | дополнительный телефон менеджера
 permissions | список | список [прав менеджера](#dict)
 
 Поля объеков phone и additional_phone:
 
 Имя | Тип | Описание
 --- | --- | ---
 country | string | код страны
 city | string | код города
 number | string | телефон
 comment | string или null | комментарий

 Поля объекта списка permissions:
 
 Имя | Тип | Описание
 --- | --- | ---
 id | число | идентификатор права
 name | строка | название права
 
 Все поля, кроме комментария к телефону и прав, являются обязательными

### Ответ

В случае успешного выполнения запроса будет возвращён статус `201 Created`.
Идентификатор созданного менеджера приходит в:

 * теле ответа в виде: `{"id": "78789890"}`
 * а так же содержится в заголовке `Location`:

```
 HTTP/1.1 201 Created
 
 Location: /employers/432/managers/78789890
```

### Ошибки

* `404 Not Found` – указанный работодатель не существует, или пользователь не имеет прав на создание менеджера
* `400 Bad argument` – ошибка во входном json

<a name="edit"></a>
## Редактирование менеджера

### Запрос
`PUT /employers/{employer_id}/managers/{manager_id}` 

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

В теле запроса передается json вида:

```json
{
    "position": "Менеджер",
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
         "country": "7",
         "city": "916",
         "number": "4555555",
         "comment": "личный"
    },
    "permissions": [
        {
            "id": 1,
            "name": "can_create_vacancy"
        }, 
        {
            "id": 3, 
            "name": "can_view_statistics"
        }
    ]
}
```

Изменять можно только поля, из приведенного json-примера. Описание полей можно посмотреть в [запросе на создание](#add).
При обновлении можно передавать как все поля, так и часть полей, которые необходимо обновить.

### Ответ

В случае успешного выполнения запроса будет возвращён статус `200 OK`.

### Ошибки

* `404 Not Found` – указанный работодатель или менеджер не существует, или пользователь не имеет прав на изменение менеджера
* `400 Bad argument` – ошибка во входном json

<a name="delete"></a>
## Удаление менеджера

<b>Удаление менеджера происходит не сразу и может занять какое-то время. 
По этой причине, если сразу после успешного удаления менеджера вы запросите, например, 
 список менеджеров, в ответе может вернуться удаленный менеджер.</b>

### Запрос

`DELETE /employers/{employer_id}/managers/{manager_id}`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

На вход в качестве обязательного параметра необходимо передавать:
`successor_id` - идентификатор менеджера, которому передаются вакансии, отклики, папки отобранных резюме, 
    комментарии к соискателю, автопоиски удаляемого менеджера

### Ответ

В случае успешного выполнения запроса будет возвращён статус `200 OK`

### Ошибки

* `404 Not Found` – указанный работодатель или менеджер не существует, или пользователь не имеет прав на удаление менеджера
* `400 Bad argument` – ошибка в параметрах запроса

<a name="list"></a>
## Справочник менеджеров работодателя

### Запрос

`GET /employers/{employer_id}/managers`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).

### Ответ

В случае успешного выполнения запроса будет возвращён статус `200 OK`. В
теле ответа будет возвращён список менеджеров работодателя, например:

```json
{
    "items": [
        {
            "id": "1507922",
            "email": "employer@example.com",
            "name": "Иванов Иван Иванович",
            "last_name": "Иванов",
            "first_name": "Иван",
            "middle_name": "Иванович",
            "vacancies_count": 0,
            "phone": {
                "country": "7",
                "city": "495",
                "number": "1568055",
                "comment": "с 9 до 17"
            },
            "additional_phone": {
                "country": "7",
                "city": "916",
                "number": "4555555",
                "comment": "личный"
            },
            "position": "Менеджер",
            "permissions": [
                {
                    "id": 1,
                    "name": "can_create_vacancy"
                }, 
                {
                    "id": 3, 
                    "name": "can_view_statistics"
                }
            ],
            "area": {
                "id": "1"
            }
        }
    ]
}
```

В элементе `items` будет содержаться список менеджеров работодателя.
Каждый элемент из `items` обладает полями, описанными в [добавлении менеджера](#add), а так же следующими полями:

<a name="fields"></a>

 Имя | Тип | Описание
 --- | --- | ---
 id | строка | Идентификатор менеджера
 name | строка | ФИО менеджера
 vacancies_count | число | количество опубликованных (активных) вакансий у данного менеджера
 
### Ошибки
 * `403 Forbidden` - С текущей авторизацией запрещено просматривать менеджеров данного работодателя

<a name="item"></a>
## Получение информации о менеджере

### Запрос

`GET /employers/{employer_id}/managers/{manager_id}`

где:

* `employer_id` - идентификатор работодателя, который можно узнать в
  [информации о текущем пользователе](me.md#employer-info).
* `manager_id` - идентификатор менеджера.

### Ответ

В случае успешного выполнения запроса, будет возвращён статус `200 OK`. В
теле ответа будет информация о менеджере, например:

```json
{
    "id": "1507922",
    "email": "employer@example.com",
    "name": "Иванов Иван Иванович",
    "last_name": "Иванов",
    "first_name": "Иван",
    "middle_name": "Иванович",
    "vacancies_count": 0,
    "phone": {
        "country": "7",
        "city": "495",
        "number": "1568055",
        "comment": "с 9 до 17"
    },
    "additional_phone": {
        "country": "7",
        "city": "916",
        "number": "4555555",
        "comment": "личный"
    },
    "position": "Менеджер",
    "permissions": [
        {
            "id": 1,
            "name": "can_create_vacancy"
        }, 
        {
            "id": 3, 
            "name": "can_view_statistics"
        }
    ],
    "area": {
        "id": "1"
    }
}
```

Поля объекта аналогичны полям в [справочнике менеджеров](#fields).

### Ошибки
* `404 Not found` - Работодатель или менеджер не найдены, или у пользователя нет прав


